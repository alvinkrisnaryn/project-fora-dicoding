const CACHE_NAME="fora-cache-v4",ASSETS_TO_CACHE=["/","/index.html","/app.bundle.js","/app.css","/images/icon.png","https://unpkg.com/leaflet@1.9.4/dist/leaflet.css","https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"];self.addEventListener("install",(e=>{console.log("[SW] Install"),e.waitUntil(caches.open(CACHE_NAME).then((e=>(console.log("[SW] Caching assets:",ASSETS_TO_CACHE),e.addAll(ASSETS_TO_CACHE).catch((e=>{throw console.error("[SW] Error caching assets:",e),e}))))))})),self.addEventListener("activate",(e=>{console.log("[SW] Activate"),e.waitUntil(caches.keys().then((e=>Promise.all(e.map((e=>{if(e!==CACHE_NAME)return console.log("[SW] Removing old cache:",e),caches.delete(e)})))))),self.clients.claim()})),self.addEventListener("fetch",(e=>{e.respondWith(caches.match(e.request).then((t=>t?(console.log("[SW] Fetch from cache:",e.request.url),t):(console.log("[SW] Fetch from network:",e.request.url),fetch(e.request)))).catch((e=>{throw console.error("[SW] Error fetching:",e),e})))})),self.addEventListener("push",(e=>{console.log("[SW] Push received, raw data:",e.data?.text());let t={title:"Notifikasi Baru",body:"Ada pesan baru untukmu!"};if(e.data)try{const a=JSON.parse(e.data.text());t.title=a.title||t.title,t.body=a.body||t.body}catch(a){console.warn("Data push bukan JSON Valid, menggunakan teks mentah",e.data.text()),t.body=e.data.text()||t.body}const a={body:t.body,icon:"/images/icon.png",badge:"/images/icon.png"};e.waitUntil(self.registration.showNotification(t.title,a))}));