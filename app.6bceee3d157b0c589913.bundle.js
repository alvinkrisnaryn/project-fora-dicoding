(()=>{"use strict";var e={56:(e,t,n)=>{e.exports=function(e){var t=n.nc;t&&e.setAttribute("nonce",t)}},72:e=>{var t=[];function n(e){for(var n=-1,a=0;a<t.length;a++)if(t[a].identifier===e){n=a;break}return n}function a(e,a){for(var r={},i=[],s=0;s<e.length;s++){var c=e[s],l=a.base?c[0]+a.base:c[0],d=r[l]||0,u="".concat(l," ").concat(d);r[l]=d+1;var m=n(u),g={css:c[1],media:c[2],sourceMap:c[3],supports:c[4],layer:c[5]};if(-1!==m)t[m].references++,t[m].updater(g);else{var p=o(g,a);a.byIndex=s,t.splice(s,0,{identifier:u,updater:p,references:1})}i.push(u)}return i}function o(e,t){var n=t.domAPI(t);return n.update(e),function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap&&t.supports===e.supports&&t.layer===e.layer)return;n.update(e=t)}else n.remove()}}e.exports=function(e,o){var r=a(e=e||[],o=o||{});return function(e){e=e||[];for(var i=0;i<r.length;i++){var s=n(r[i]);t[s].references--}for(var c=a(e,o),l=0;l<r.length;l++){var d=n(r[l]);0===t[d].references&&(t[d].updater(),t.splice(d,1))}r=c}}},113:e=>{e.exports=function(e,t){if(t.styleSheet)t.styleSheet.cssText=e;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(e))}}},177:(e,t,n)=>{n.d(t,{A:()=>s});var a=n(601),o=n.n(a),r=n(314),i=n.n(r)()(o());i.push([e.id,"// extracted by mini-css-extract-plugin\nexport {};",""]);const s=i},287:(e,t,n)=>{n.d(t,{A:()=>s});var a=n(601),o=n.n(a),r=n(314),i=n.n(r)()(o());i.push([e.id,"// extracted by mini-css-extract-plugin\nexport {};",""]);const s=i},314:e=>{e.exports=function(e){var t=[];return t.toString=function(){return this.map((function(t){var n="",a=void 0!==t[5];return t[4]&&(n+="@supports (".concat(t[4],") {")),t[2]&&(n+="@media ".concat(t[2]," {")),a&&(n+="@layer".concat(t[5].length>0?" ".concat(t[5]):""," {")),n+=e(t),a&&(n+="}"),t[2]&&(n+="}"),t[4]&&(n+="}"),n})).join("")},t.i=function(e,n,a,o,r){"string"==typeof e&&(e=[[null,e,void 0]]);var i={};if(a)for(var s=0;s<this.length;s++){var c=this[s][0];null!=c&&(i[c]=!0)}for(var l=0;l<e.length;l++){var d=[].concat(e[l]);a&&i[d[0]]||(void 0!==r&&(void 0===d[5]||(d[1]="@layer".concat(d[5].length>0?" ".concat(d[5]):""," {").concat(d[1],"}")),d[5]=r),n&&(d[2]?(d[1]="@media ".concat(d[2]," {").concat(d[1],"}"),d[2]=n):d[2]=n),o&&(d[4]?(d[1]="@supports (".concat(d[4],") {").concat(d[1],"}"),d[4]=o):d[4]="".concat(o)),t.push(d))}},t}},387:(e,t,n)=>{n.d(t,{A:()=>s});var a=n(601),o=n.n(a),r=n(314),i=n.n(r)()(o());i.push([e.id,"// extracted by mini-css-extract-plugin\nexport {};",""]);const s=i},540:e=>{e.exports=function(e){var t=document.createElement("style");return e.setAttributes(t,e.attributes),e.insert(t,e.options),t}},601:e=>{e.exports=function(e){return e[1]}},659:e=>{var t={};e.exports=function(e,n){var a=function(e){if(void 0===t[e]){var n=document.querySelector(e);if(window.HTMLIFrameElement&&n instanceof window.HTMLIFrameElement)try{n=n.contentDocument.head}catch(e){n=null}t[e]=n}return t[e]}(e);if(!a)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");a.appendChild(n)}},825:e=>{e.exports=function(e){if("undefined"==typeof document)return{update:function(){},remove:function(){}};var t=e.insertStyleElement(e);return{update:function(n){!function(e,t,n){var a="";n.supports&&(a+="@supports (".concat(n.supports,") {")),n.media&&(a+="@media ".concat(n.media," {"));var o=void 0!==n.layer;o&&(a+="@layer".concat(n.layer.length>0?" ".concat(n.layer):""," {")),a+=n.css,o&&(a+="}"),n.media&&(a+="}"),n.supports&&(a+="}");var r=n.sourceMap;r&&"undefined"!=typeof btoa&&(a+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(r))))," */")),t.styleTagTransform(a,e,t.options)}(t,e,n)},remove:function(){!function(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e)}(t)}}}}},t={};function n(a){var o=t[a];if(void 0!==o)return o.exports;var r=t[a]={id:a,exports:{}};return e[a](r,r.exports,n),r.exports}n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var a in t)n.o(t,a)&&!n.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.nc=void 0;const a={parseActiveUrl(){const e=this._urlSplitter(window.location.hash.slice(1));return e.length?{resource:e[0]||"home",id:e[1]||null,verb:e[2]||null}:{resource:"home",id:null,verb:null}},parseActiveUrlWithCombiner(){const e=this.parseActiveUrl();return this._urlCombiner(e)},_urlSplitter:e=>(e.startsWith("/")?e:`/${e}`).split("/").filter(Boolean),_urlCombiner:({resource:e,id:t,verb:n})=>(e?`/${e}`:"/")+(t?"/:id":"")+(n?`/${n}`:"")},o="stories";function r(){return new Promise(((e,t)=>{const n=indexedDB.open("ForaDB",1);n.onupgradeneeded=e=>{const t=e.target.result;t.objectStoreNames.constains(o)||t.createObjectStore(o,{keyPath:"id"}).createIndex("created_at","created_at",{unique:!1})},n.onsuccess=t=>{e(t.target.result)},n.onerror=e=>{t(`Error opening database: ${e.target.error}`)}}))}const i="https://story-api.dicoding.dev/v1",s=async()=>{try{const e=await fetch(`${i}/stories`,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);const t=await e.json();return console.log("Data stories:",t.listStory),await async function(e){console.log("Saving stories:",e);try{const t=(await r()).transaction([o],"readwrite"),n=t.objectStore(o).clear();await new Promise(((e,t)=>{n.onsuccess=e,n.onerror=()=>t("Error clearing object store")}));for(const t of e)t.put(t);await new Promise(((e,n)=>{t.oncomplete=e,t.onerror=()=>n("Error saving stories")}))}catch(e){throw console.error("Error saving stories:",e),e}}(t.listStory),await async function(e=7){try{const t=(await r()).transaction([o],"readwrite"),n=t.objectStore(o).index("created_at"),a=new Date,i=new Date(a.setDate(a.getDate()-e));n.openCursor().onsuccess=e=>{const t=e.target.result;t&&(new Date(t.value.created_at)<i&&t.delete(),t.continue())},await new Promise(((e,n)=>{t.oncomplete=e,t.onerror=()=>n("Error deleting old stories")}))}catch(e){throw console.error("Error clearing old stories:",e),e}}(7),t.listStory}catch(e){console.error("Error fetching stories:",e);const t=await async function(){try{const e=(await r()).transaction([o],"readonly").objectStore(o),t=await e.getAll();return new Promise(((e,n)=>{t.onsuccess=()=>e(t.result),t.onerror=()=>n("Error fetching stories")}))}catch(e){throw console.error("Error fetching stories:",e),e}}();if(t&&t.length>0)return console.log("Using cached stories:",t),t;throw new Error("No stories available offline")}},c="https://story-api.dicoding.dev/v1";function l(e){const t=(e+"=".repeat((4-e.length%4)%4)).replace(/-/g,"+").replace(/_/g,"/"),n=window.atob(t),a=new Uint8Array(n.length);for(let e=0;e<n.length;++e)a[e]=n.charCodeAt(e);return a}async function d(e){try{if("granted"!==await Notification.requestPermission())return console.log("Notification permission denied"),null;const t=await e.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:l("BCCs2eonMI-6H2ctvFaWg-UYdDv387Vno_bzUzALpB442r2lCnsHmtrx8biyPi_E-1fSGABK_Qs_GlvPoJJqxbk")}),n=localStorage.getItem("token");if(!n)return console.warn("Token tidak ditemukan."),null;if(await fetch(`${c}/notifications/subscribe`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${n}`},body:JSON.stringify(t)}),console.log("Push subscription successful"),"granted"===Notification.permission){const e=new Notification("Langganan berhasil",{body:"Anda telah berlangganan notifikasi.",icon:"/images/logo.png",badge:"/images/favicon.png",requireInteraction:!1});setTimeout((()=>e.close()),5e3)}return t}catch(e){return console.error("Push subscription failed",e),null}}function u(e){const t=document.getElementById("subscriptionButton");t?e?(t.textContent="UNSUBSCRIBE",t.classList.add("subscribed")):(t.textContent="SUBSCRIBE",t.classList.remove("subscribed")):console.error("Tombol subscribe tidak ditemukan.")}async function m(e){const t=document.getElementById("subscriptionButton");if(!t)return void console.error("Tombol subscribe tidak ditemukan.");if("true"===t.dataset.listenerAttached)return;t.dataset.listenerAttached="true";let n=await e.pushManager.getSubscription();u(n),t.addEventListener("click",(async()=>{if(t.classList.contains("subscribed")){const t=await async function(e){try{const t=await e.pushManager.getSubscription();if(!t)return console.log("No subscription to unsubscribe"),!1;const n=localStorage.getItem("token");if(!n)return console.warn("Token tidak ditemukan."),!1;if(await fetch(`${c}/notifications/unsubscribe`,{method:"DELETE",headers:{"Content-Type":"application/json",Authorization:`Bearer ${n}`},body:JSON.stringify({endpoint:t.endpoint})}),await t.unsubscribe(),console.log("Push unsubscription successful"),"granted"===Notification.permission){const e=new Notification("Berhasil Unsubscribe",{body:"Anda telah berhenti langganan notifikasi.",icon:"/images/logo.png",badge:"/images/favicon.png",requireInteraction:!1});setTimeout((()=>e.close()),5e3)}return!0}catch(e){return console.error("Push unsubscription failed",e),!1}}(e);t&&(n=null,u(null))}else n=await d(e),n&&u(n)}))}class g{#e;constructor({view:e}){this.#e=e}async init(){await this.loadStories(),await d()}async loadStories(){try{const e=await s();e&&0!==e.length?this.#e.showStories(e,!1):this.#e.showNoStories()}catch(e){"No stories available offline"===e.message?this.#e.showNoStories():this.#e.showStories(await s(),!0)}}}const p={render:async()=>localStorage.getItem("token")?'\n      <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />\n      <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"><\/script>\n      <section class="content">\n        <h1>Selamat datang di Fora</h1>\n        <h2>Review terbaru</h2>\n        <p>Ini adalah halaman beranda dengan daftar tempat makan</p>\n        <div id="stories" aria-label="Daftar review tempat makan">\n          <div id="loading" style="text-align: center; padding: 20px;">\n            <p>Memuat review...</p>\n          </div>\n        </div>\n        <h2>Peta Lokasi Review</h2>\n        <div id="map" style="height: 400px; margin-top: 20px;"></div>\n      </section>\n    ':(window.location.replace("#/login"),""),async afterRender(){localStorage.getItem("token")&&(this.map=L.map("map").setView([-6.2088,106.8456],10),L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'}).addTo(this.map),new g({view:this}).loadStories())},showStories(e,t=!1){const n=document.querySelector("#stories");n.innerHTML="";const a=document.querySelector("#loading");a&&a.remove(),t&&(n.innerHTML='<p aria-label="Mode Offline">Data diambil dari cache offline</p>'),y;const o=e.slice(0,10);o.forEach((e=>{n.innerHTML+=`\n        <article class="story-card">\n          <a href="#/detail/${e.id}">\n            <img \n              src="${e.photoUrl}" \n              alt="Foto review oleh ${e.name}" \n              width="200"\n            >\n            <h3>${e.name}</h3>\n          </a>\n          <p>${e.description}</p>\n          <p><small>Dibuat pada: ${new Date(e.createdAt).toLocaleString("id-ID",{day:"numeric",month:"long",year:"numeric",hour:"2-digit",minute:"2-digit"})}</small></p>\n        </article>\n      `,e.lat&&e.lon&&this.map&&L.marker([e.lat,e.lon]).addTo(this.map).bindPopup(`<b>${e.name}</b><br>${e.description}`)}));const r=o.filter((e=>e.lat&&e.lon));if(r.length>0){const e=L.latLngBounds(r.map((e=>[e.lat,e.lon])));this.map.fitBounds(e,{padding:[50,50],maxZoom:10})}else this.map.setView([-6.2088,106.8456],10)},showNoStories(){const e=document.querySelector("#stories"),t=document.querySelector("#loading");t&&t.remove(),e.innerHTML="<p>Belum ada review</p>"},showError(e){const t=document.querySelector("#stories"),n=document.querySelector("#loading");n&&n.remove(),t.innerHTML=`<p style="color:red;">Gagal memuat review: ${e}</p>`}},h={render:async()=>localStorage.getItem("token")?'\n      <section class="about">\n        <h2>Tentang Fora</h2>\n        <p>Fora adalah aplikasi berbasis web yang memungkinkan pengguna menemukan, menilai, dan menambahkan tempat makan favorit mereka. Aplikasi ini dikembangkan sebagai bagian dari pembelajaran membangun SPA dengan JavaScript Vanilla dan Webpack.</p>\n      </section>\n    ':(window.location.hash="#/login",""),async afterRender(){}};var w=n(72),v=n.n(w),f=n(825),b=n.n(f),k=n(659),S=n.n(k),E=n(56),I=n.n(E),T=n(540),B=n.n(T),A=n(113),P=n.n(A),x=n(287),M={};M.styleTagTransform=P(),M.setAttributes=I(),M.insert=S().bind(null,"head"),M.domAPI=b(),M.insertStyleElement=B(),v()(x.A,M),x.A&&x.A.locals&&x.A.locals;class R{#e;constructor({view:e}){this.#e=e}async performLogin(e,t){try{const n=await(async(e,t)=>{try{const n=await fetch("https://story-api.dicoding.dev/v1/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e,password:t})}),a=await n.json();if(!n.ok)throw new Error(a.message||"Login gagal");return a.loginResult.token}catch(e){throw console.error("Login error:",e),e}})(e,t);localStorage.setItem("token",n),localStorage.setItem("name","User"),this.#e.showSuccess(),window.location.hash="/home",z.renderPage()}catch(e){this.#e.showError(`Login gagal: ${e.message}`)}}}const $={render:async()=>localStorage.getItem("token")?(console.log("Access denied to /login: Already logged in"),window.location.hash="#/home",""):'\n      <section class="login-section">\n        <div class="background-wrapper">\n          <div class="form-login">\n            <fieldset>\n              <legend>Foraa</legend>\n              <h3>Welcome Back</h5>\n              <p>Sign in with your email address and password</p>\n              <form id="loginForm">\n                <label for="email">Email Address</label>\n                <input type="email" id="email" placeholder="Email" required />\n                <p id="error-message" style="color:red;"></p>\n                <label for="password">Password</label>\n                <input type="password" id="password" placeholder="Password" required />\n                <div class="login-option">\n                  <label>\n                    <input type="checkbox" id="remember" name="remember" />\n                    Remember me\n                  </label>\n                  <a href="#" id="forgot-password">Forgot Password?</a>\n                </div>\n                <button type="submit" class="button-login">Sign In</button>\n              </form>\n            <div class="register">\n              <p>Don\'t have an account? <a href="#/register" class="register-link">Sign Up</a></p>\n            </div>\n            </fieldset>\n          </div>\n        </div>\n      </section>\n    ',async afterRender(){const e=document.getElementById("loginForm"),t=document.getElementById("error-message"),n=new R({view:this});e.addEventListener("submit",(async e=>{e.preventDefault();const t=document.getElementById("email").value,a=document.getElementById("password").value;await n.performLogin(t,a)})),this.showSuccess=()=>{console.log("Login success")},this.showError=e=>{t.textContent=e}}};var D=n(387),U={};U.styleTagTransform=P(),U.setAttributes=I(),U.insert=S().bind(null,"head"),U.domAPI=b(),U.insertStyleElement=B(),v()(D.A,U),D.A&&D.A.locals&&D.A.locals;class C{constructor({view:e}){this._view=e}async registerNewUser(e,t,n){try{await(async(e,t,n)=>{try{const a=await fetch(`${i}/register`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:e,email:t,password:n})}),o=await a.json();if(!a.ok)throw new Error(o.message||"Registrasi gagal");return o}catch(e){throw console.error("Register error:",e),e}})(e,t,n),this._view.showSuccess("Register berhasil!, Silahkan Login"),setTimeout((()=>{window.location.hash="#/login"}),1500)}catch(e){let t="Gagal daftar, silahkan coba lagi yaa.";e.message.includes("Email as ready tak")?t="Email sudah terdaftar. Gunakan Email lain.":e.message.includes("Password")?t="Kata sandi harus minimal 8 karakter":e.message&&(t=e.message),this._view.showError(t)}}}const j={render:async()=>localStorage.getItem("token")?(console.log("Access denied to /register: Already logged in"),window.location.hash="#/home",""):'\n      <section class="register-section">\n        <div class="background-wrapper">\n          <h2>Daftar Akun Baru</h2>\n          <form id="register-form">\n            <input type="text" id="name" placeholder="Nama Lengkap" required />\n            <input type="email" id="email" placeholder="Email" required />\n            <input type="password" id="password" placeholder="Password" required />\n            <button type="submit">Daftar</button>\n            <span id="register-message"></span>\n          </form>\n        </div>\n      </section>\n    ',async afterRender(){const e=document.getElementById("register-form"),t=document.getElementById("register-message"),n={showSuccess(e){t.innerHTML=e},showError(e){t.innerHTML=e}},a=new C({view:n});e.addEventListener("submit",(async t=>{t.preventDefault();const o=e.name.value,r=e.email.value,i=e.password.value;i.length<8?n.showError("Kata sandi harus minimal 8 karakter."):r.includes("@")&&r.includes(".")?await a.registerNewUser(o,r,i):n.showError("Email tidak valid.")}))}};let N=null;const O=()=>{if(N){N.getTracks().forEach((e=>e.stop())),N=null;const e=document.getElementById("camera");e&&(e.srcObject=null)}};class H{#e;constructor({view:e}){this.#e=e}async submitStory(e,t){try{await(async e=>{const t=localStorage.getItem("token"),n=await fetch("https://story-api.dicoding.dev/v1/stories",{method:"POST",headers:{Authorization:`Bearer ${t}`},body:e}),a=await n.json();if(!n.ok)throw new Error(a.message);return a})(e),this.#e.showSuccess("Berhasil mengirim review!"),t&&await t();try{O()}catch(e){console.warn("Failed to stop camera:",e)}setTimeout((()=>{window.location.hash="#/home"}),1500)}catch(e){console.log("Error submmiting story:",e),this.#e.showError(`Gagal mengirim review: ${e.message}`)}}}const q={render:async()=>localStorage.getItem("token")?'\n      <section class="add-story">\n        <h2>Tambah Review</h2>\n        <form id="storyForm">\n          <label for="description">Deskripsi Review</label>\n          <textarea id="description" placeholder="Tulis review kamu di sini..." required></textarea>\n          \n          <label for="photo">Unggah Gambar (opsional jika tidak pakai kamera)</label>\n          <input type="file" id="photo" accept="image/*" aria-describedby="photo-desc" />\n          <p id="photo-desc" class="visually-hidden">Pilih satu gambar dari file atau gunakan kamera</p>\n\n          <div class="camera-section">\n              <video id="camera" autoplay aria-label>Tampilkan kamera langsung</video>\n              <canvas id="snapshot" style="display: none;"></canvas>\n              <button type="button" id="captureButton" aria-label="Ambil foto dari kamera">Ambil Foto</button>\n          </div>\n\n          <div id="image-preview" style="margin-top:1em;">\n            <h4>Preview Gambar:</h4>\n            <img id="preview-img" src="" alt="Preview gambar hasil kamera atau upload" style="max-width: 100%; display: none;" />\n          </div>\n\n          <button type="submit">Kirim</button>\n        </form>\n        <p id="submit-message"></p>\n\n        <div id="map" style="height: 300px; margin-top: 1em;" aria-label="Peta lokasi"></div>\n        \n        <input type="hidden" id="lat" aria-describedby="latlon-desc">\n        <input type="hidden" id="lon" aria-describedby="latlon-desc">\n        <p id="latlon-desc" class="visually-hidden">Klik pada peta untuk memilih lokasi review</p>\n      </section>\n    ':(window.location.hash="#/login",""),async afterRender(){if(!localStorage.getItem("token"))return void(window.location.hash="#/login");const e=document.getElementById("storyForm"),t=document.getElementById("submit-message");try{await(async()=>{const e=await navigator.mediaDevices.getUserMedia({video:!0});N=e,document.getElementById("camera").srcObject=e})()}catch(e){console.warn("Failed to initialize camera:",e),t&&(t.innerText="Gagal menginisialisasi kamera. Silahkan unggah gambar secara manual.")}const n=document.getElementById("photo");document.getElementById("captureButton").addEventListener("click",(async()=>{try{const e=await(()=>{const e=document.getElementById("camera"),t=document.getElementById("snapshot"),n=t.getContext("2d");return t.width=e.videoWidth,t.height=e.videoHeight,n.drawImage(e,0,0,t.width,t.height),new Promise((e=>{t.toBlob((t=>{e(t)}),"image/jpeg")}))})();window.capturedPhotoBlob=e,n.value="";const t=document.getElementById("preview-img");t.src=URL.createObjectURL(e),t.style.display="block"}catch(e){console.error("Error capturing image:",e),t.innerText="Gagal mengambil foto dari kamera."}})),n.addEventListener("change",(()=>{window.capturedPhotoBlob=null;const e=n.files[0],t=document.getElementById("preview-img");t&&(e?(t.src=URL.createObjectURL(e),t.style.display="block"):preview.style.display="none")}));const a=new H({view:this}),o=async()=>{try{const e=document.getElementById("preview-img");e&&e.src&&(URL.revokeObjectURL(e.src),e.src="",e.style.display="none")}catch(e){console.warn("Error during cleanup:",e)}};e.addEventListener("submit",(async e=>{e.preventDefault();const n=document.getElementById("description").value,r=document.getElementById("photo").files[0],i=window.capturedPhotoBlob,s=document.getElementById("lat").value,c=document.getElementById("lon").value;if(!s||!c)return void(t.innerText="Silakan pilih lokasi pada peta.");if(!r&&!i)return void(t.innerText="Silakan unggah gambar atau gunakan kamera.");if(r&&i)return void(t.innerText="Pilih salah satu: upload file ATAU ambil dari kamera.");const l=new FormData;l.append("description",n),l.append("photo",r||i),l.append("lat",s),l.append("lon",c),await a.submitStory(l,o)})),window.addEventListener("hashchange",(()=>{try{O()}catch(e){console.warn("Error stopping camera on hashchange:",e)}}));const r=L.map("map").setView([-6.2,106.816666],13);let i;L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:"&copy; OpenStreetMap contributors"}).addTo(r),r.on("click",(e=>{const{lat:t,lng:n}=e.latlng;i?i.setLatLng([t,n]):i=L.marker([t,n]).addTo(r),document.getElementById("lat").value=t,document.getElementById("lon").value=n})),this.showSuccess=e=>{t?t.innerText=e:console.error("Message element not found")},this.showError=e=>{t?t.innerText=e:console.error("Message element not found")}},async beforeLeave(){try{O()}catch(e){console.warn("Error stopping camera on beforeLeave:",e)}}};class F{#e;constructor({view:e}){this.#e=e}async loadStory(e){try{const t=await(async e=>{const t=localStorage.getItem("token");if(console.log("Token:",t?"Valid":"Missing"),!t)throw new Error("Token tidak ditemukan. Silakan login.");try{const n=await fetch(`https://story-api.dicoding.dev/v1/stories/${e}`,{method:"GET",headers:{Authorization:`Bearer ${t}`}}),a=await n.json();return n.ok?a.story:(console.error("API error:",a.message),null)}catch(e){return console.error("Fetch error:",e),null}})(e);if(!t)return void this.#e.showError("Cerita tidak ditemukan. Pastikan ID cerita valid atau coba lagi nanti.");this.#e.showStory(t)}catch(e){this.#e.showError(`Error: ${e.message}`)}}}const _={"/":p,"/home":p,"/login":$,"/register":j,"/add":q,"/about":h,"/detail/:id":{render:async()=>localStorage.getItem("token")?'\n      <section class="story-detail">\n        <div id="story-container">Loading...</div>\n      </section>\n    ':(console.log("Access denied to /detail: No token found"),window.location.hash="#/login",""),async afterRender(){const e=a.parseActiveUrl().id;if(console.log("Requested Story ID:",e),!e||!e.startsWith("story-"))return void(document.getElementById("story-container").innerHTML="<p>ID cerita tidak valid. Harus dimulai dengan 'story-'.</p>");const t=new F({view:this});await t.loadStory(e)},showStory(e){if(document.getElementById("story-container").innerHTML=`\n      <article aria-label="Detail review pengguna">\n        <h1>Detail Review</h1>\n        <img src="${e.photoUrl}" alt="Foto review oleh ${e.name}" style="max-width: 300px;" />\n        <h2>${e.name}</h2>\n        <p><strong>Deskripsi:</strong> ${e.description}</p>\n        <p><strong>Dibuat pada:</strong> ${new Date(e.createdAt).toLocaleString()}</p>\n        ${e.lat&&e.lon?`\n              <p><strong>Lokasi:</strong> ${e.lat}, ${e.lon}</p>\n              <div id="map-detail" style="height: 300px; margin-top: 1em;"></div>\n            `:"<p><em>Lokasi tidak tersedia</em></p>"}\n      </article>\n    `,e.lat&&e.lon){const t=L.map("map-detail").setView([e.lat,e.lon],15);L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:"&copy; OpenStreetMap contributors"}).addTo(t),L.marker([e.lat,e.lon]).addTo(t).bindPopup("Lokasi review ini").openPopup()}},showError(e){document.getElementById("story-container").innerHTML=`<p style="color: red;">${e}</p>`}}},W={render:async()=>'\n      <nav class="navbar" role="navigation" aria-label="Navigasi Utama">\n        <ul class="navbar-list">\n          <li><a href="#/home">Home</a></li>\n          <li><a href="#/add">Add</a></li>\n          <li><a href="#/about">About</a></li>\n        </ul>\n        <button id="subscriptionButton">SUBSCRIBE</button>\n        <button id="logoutButton" class=""logout-button style="width: 44px; height: 44px; cursor: pointer; background-color: red">Logout</button>\n      </nav>\n    ',async afterRender(){const e=document.getElementById("logoutButton");localStorage.getItem("token")?(e.style.display="inline-block",e.addEventListener("click",(()=>{localStorage.removeItem("token"),localStorage.removeItem("name"),window.location.href="#/login"}))):e.style.display="none","serviceWorker"in navigator&&"PushManager"in window&&m(await navigator.serviceWorker.ready)}},z={previousPage:null,lastRoute:null,async renderPage(){const e=localStorage.getItem("token"),t=a.parseActiveUrl(),n=document.querySelector("#main-content"),o=document.querySelector("#navbar");if(!n)return void console.error("Element #main-content not found");const r=a.parseActiveUrlWithCombiner();if(console.log("Route key:",r),r===this.lastRoute&&!e)return void console.log("Skipping render: Same route as lastRoute");this.lastRoute=r;const i=["/home","/add","/about","/detail/:id"].includes(r)||r.startsWith("/detail/"),s="login"===t.resource||"register"===t.resource;if(s&&e)return window.location.hash="/home",void await this.renderPage();if(i&&!e)return window.location.hash="/login",void await this.renderPage();const c=_[r]||_["/home"];console.log("Selected page:",c),this.previousPage?.beforeLeave&&await this.previousPage.beforeLeave(),!s&&o?(o.innerHTML=await W.render(),await W.afterRender()):o&&(o.innerHTML=""),n.innerHTML="";try{n.innerHTML=await c.render(),await(c.afterRender?.())}catch(e){n.innerHTML="<p>Error rendering page</p>",console.error("Rendering error:",e)}this.previousPage=c}};var G=n(177),V={};V.styleTagTransform=P(),V.setAttributes=I(),V.insert=S().bind(null,"head"),V.domAPI=b(),V.insertStyleElement=B(),v()(G.A,V),G.A&&G.A.locals&&G.A.locals,window.addEventListener("hashchange",(()=>{console.log("Hashchange event triggered"),async function(e){document.startViewTransition?document.startViewTransition((()=>{e()})):await e()}((()=>z.renderPage()))})),window.addEventListener("load",(()=>{console.log("Window Loaded, rendering page..."),z.renderPage(),window.addEventListener("online",(()=>{const e=document.getElementById("offline");e&&(e.style.display="none",z.renderPage())})),window.addEventListener("offline",(()=>{const e=document.getElementById("offline");e&&(e.style.display="block",z.renderPage())})),document.addEventListener("DOMContentLoaded",(()=>{if(console.log("DOM fully loaded, registering service worker"),"serviceWorker"in navigator&&"PushManager"in window)navigator.serviceWorker.register("/service-worker.js").then((e=>{console.log("Service Worker registered:",e),console.log("Service Worker scope:",e.scope),requestAnimationFrame((()=>{m(e)}))})).catch((e=>{console.error("Service Worker registration failed:",e)}));else{console.warn("Push notification tidak mendukung di browser ini.");const e=document.getElementById("subscriptionButton");e&&(e.disabled=!0)}}))}))})();